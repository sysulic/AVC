<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SoundAbstract: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="GitHub-Mark-Light-120px-plus.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SoundAbstract
   &#160;<span id="projectnumber">2.5</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Main Page </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md0">System function introduction</a></li>
<li class="level1"><a href="#autotoc_md1">Catalog Introduction</a></li>
<li class="level1"><a href="#autotoc_md2">The Main Process</a></li>
<li class="level1"><a href="#autotoc_md3">Important Class and Function description</a><ul><li class="level2"><a href="#autotoc_md4">Main Function</a></li>
<li class="level2"><a href="#autotoc_md5">Parsers</a><ul><li class="level3"><a href="#autotoc_md6">QNPparser</a></li>
<li class="level3"><a href="#autotoc_md7">ReinfinementMapParser.py</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md8">Regression Classes</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="mainpage"></a></p>
<p>Installation dependencies:</p>
<div class="fragment"><div class="line">pip install z3 z3-solver==4.8.10.0 networkx func_timeout matplotlib </div>
</div><!-- fragment --><p>Based on python3.8, this tool automatically verifies whether high-level modeling is a "sound abstraction" corresponding to low-level models. Some windows users may need the following installation scripts if they are not using miniconda:</p>
<div class="fragment"><div class="line">python -m pip install z3 z3-solver==4.8.10.0 networkx func_timeout matplotlib </div>
</div><!-- fragment --><p>Parameters:</p>
<div class="fragment"><div class="line">&gt; python main.py --help</div>
<div class="line">usage: main.py [-h] [-domainname DOMAINNAME] [-DEBUG DEBUG] [-timeout_number TIMEOUT_NUMBER]</div>
<div class="line"> </div>
<div class="line">hig-low sound abstraction prove.</div>
<div class="line"> </div>
<div class="line">optional arguments:</div>
<div class="line">  -h, --help            show this help message and exit</div>
<div class="line">  -domainname DOMAINNAME</div>
<div class="line">                        domainname for qnp/pddl/refinementmap/constraint files -- OPTIONAL FOR TEST</div>
<div class="line">  -DEBUG DEBUG          print DEBUG message or not -- OPTIONAL FOR TEST</div>
<div class="line">  -timeout_number TIMEOUT_NUMBER</div>
<div class="line">                        the autogenerated prove file wait for timeout_number(s),if timeout,it will return unknown message and then please open the file and add some  </div>
<div class="line">                        Necessary constraint message. -- OPTIONAL FOR TEST</div>
</div><!-- fragment --><p>The default parameter equivalent call:</p>
<div class="fragment"><div class="line">python main.py </div>
<div class="line">python main.py -domainname &quot;blocks_clear&quot; -DEBUG False -timeout_number 3.1415926</div>
</div><!-- fragment --><p>take gripper for example:</p>
<div class="fragment"><div class="line">python main.py -domainname &quot;gripper&quot; -DEBUG True -timeout_number 10 </div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md0"></a>
System function introduction</h1>
<ul>
<li>Input: Two pddl files of the low-level STRIPS model, placed in the example folder + high-level QNP file + refined mapping files from high-level to low-level programs.</li>
<li>Output: Determine whether the high-level is the "sound abstraction" corresponding to the low-level program.</li>
<li>Program input:</li>
</ul>
<p>Although you only need to pass in &lsquo;domainname ='block_clear&rsquo;<code>(denoted by</code>{domainname}` below}) for convenience, each certification task requires the user to provide four corresponding location files by hand, and the files need to meet the following naming conventions:</p>
<ol type="1">
<li>“<code>./examples/{domainname}/{domainname}\_d.txt</code>“Use STRIPS modeling to write a low-level problem domain description file in pddl format, and "`./examples/{domainname}/{domainname}\_p.txt`"Problem description file for low-level problems (expanded keywords to adapt to Golog program input).</li>
<li>“<code>./examples/{domainname}/{domainname}.qnp</code>“QNP format refers to the format proposed by <code>qnp2fond</code> .</li>
<li>“<code>./refinementMap/{domainname}/{domainname}_RefinementMap.txt</code>” refinment mapping files.</li>
<li>“<code>./constrainsConfig/{domainname }_constrain.txt</code>“The background knowledge and common sense axioms known by the computer need to be provided in the proof process, that is, the text file of the domain-specific constraint axiom set, and the format can refer to the z3 logic formula writing specification. Temporary variables such as z and w that only appear here need to be declared in the file before they are used.</li>
</ol>
<ul>
<li>Final output file：</li>
</ul>
<p>All the files below <code>autogenerated</code> are automatically generated. The <code>*.py</code> file is the automatically generated specific theorem file that meets the z3-solver format, and the others are auxiliary files, including:</p>
<p>Under the <code>constrainsConfig</code> folder is the domain constraint <code>domain constrain</code> file, <code>domain_steps_configJSON</code> is the relevant certification formula dictionary, and under the <code>domain_template</code> is the automatically generated <code>python</code> certification file template. All <code>json</code> related configuration information can refer to the corresponding file name, and the generated png image is the <code>scenario-action-parameters</code> migration diagram of the low-level <code>Golog</code> program corresponding to the high-level action of the corresponding name.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Catalog Introduction</h1>
<p>Folders</p>
<div class="fragment"><div class="line">autogenerated # The *.py file under autogenerated automatically generated is the &quot;certification file&quot; corresponding to the certification subtask, here is the target file, and then</div>
<div class="line">constrainsConfig # Configure the state constraint formula of a specific proof domain here. If the file is empty, it means that there is no constraint</div>
<div class="line">examples # Store the pddl input file of STRIPS and the qnp input file of QNP</div>
<div class="line">refinementMap #Store refinement mapping function input file</div>
</div><!-- fragment --><p> Files</p>
<div class="fragment"><div class="line">main.py # main program entry</div>
<div class="line"> </div>
<div class="line">PDDLaction.py # Low-level action class, used in refinementMapParser.py to store low-level STRIPS action information</div>
<div class="line"> </div>
<div class="line">QNPparser.py # parser that reads qnp files</div>
<div class="line"> </div>
<div class="line">refinementMapParser.py # The parser of the pddl file and the parser of the refinement mapping file, called here</div>
<div class="line"> </div>
<div class="line">GologProgramTree.py # In the refined mapping, a high-level action ==&gt; a low-level Golog program tree</div>
<div class="line"> </div>
<div class="line">Regression.py # All functions related to regression, including &quot;single-step regression/circular regression to program input scenario s_i/extended existence regression/extended arbitrary regression&quot;</div>
<div class="line"> </div>
<div class="line">topologicalSort.py # The scene change arrow is reversed, and then the topological sorting is used to get the cyclic regression scene change order ssa is &quot;left node.s_output&quot; replaced with &quot;right node.s_input&quot;</div>
<div class="line"> </div>
<div class="line">utils.py # Tool functions are here, including delete_all_files_in_dir_autogenerated run_all_python_prove_file_in_dir_autogenerated and other tool functions</div>
<div class="line"> </div>
<div class="line">requirements.txt</div>
<div class="line"> </div>
<div class="line">README.md</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2"></a>
The Main Process</h1>
<ol type="1">
<li>“<code>Dict for Theorems which will be proved</code>“ write into JSON files in “<code>./autogenerated/domain_steps_configJSON/{0}_{1}_config.json</code>“.format(domainname,whichStepToProve). whichStepToProve = 'I','G', Preconditions of actions,effects of actions</li>
<li>“<code>path_of_template_py</code> = <code>./autogenerated/domain_template/{0}_template.py</code>“.format(domainname)<code></code></li>
<li><code>using “</code>JSON files<code>“ and “</code>path_of_template_py<code>“, function “</code>autogenerator_python_prove_file<code>“ will generate goals of prove files in “</code>./autogenerated/{0}_*.py.format(domainname)`“</li>
</ol>
<p>The core processing logic generates the <code>json</code> file in the first step：</p>
<blockquote class="doxtable">
<p>JSON is based on "`prove_tasks_list`" to prove the task list, such as &lsquo;['I&rsquo;,'G','pickabove_pre','pickabove_eff','putaside_pre','putaside_eff']<code>, respectively processing the corresponding proof tasks to get the corresponding &lt;/blockquote&gt;The low-level language logic formula that needs to be proved in the</code>json` configuration file contains the corresponding high-level language logic formula.</p>
<p>The processing conversion of the low-level <code>Golog</code> program is the second core logic.</p>
<p></p>
</blockquote>
<h1><a class="anchor" id="autotoc_md3"></a>
Important Class and Function description</h1>
<h2><a class="anchor" id="autotoc_md4"></a>
Main Function</h2>
<div class="fragment"><div class="line">main.py # The outline of the detailed calculation and generation process of the entry main program</div>
<div class="line">&quot;&quot;&quot;</div>
<div class="line">    main process:</div>
<div class="line">    1. &quot;Dict for Theorems which will be proved&quot; write into jsonfiles in &quot;./autogenerated/domain_steps_configJSON/{0}_{1}_config.json&quot;.format(domainname,whichStepToProve). whichStepToProve = &#39;I&#39;,&#39;G&#39;, Preconditions of actions,effects of actions will &quot;Automatically generate formulas that need to be proved and configure them in the json file&quot;.</div>
<div class="line">    2. path_of_template_py = &quot;./autogenerated/domain_template/{0}_template.py&quot;.format(domainname)---Automatically generate the template file used when generating the python certification file in z3-solver format</div>
<div class="line">    3. using &quot;jsonfiles&quot; and &quot;path_of_template_py&quot;, function autogenerator_python_prove_file will generate goals of provefiles in &quot;./autogenerated/{0}_*.py&quot;.format(domainname)---Generate and run the python certification file corresponding to the z3-solver format.</div>
<div class="line">&quot;&quot;&quot;</div>
<div class="line">    # delete all files in dir autogenerated before</div>
<div class="line">    ......# Omit the specific implementation follow-up explanation here, the same below</div>
<div class="line">    # PDDL parser</div>
<div class="line">    ......</div>
<div class="line">    # RefinementMap parser</div>
<div class="line">    ......</div>
<div class="line">    # QNP parser</div>
<div class="line">    ......</div>
<div class="line">    # Refinement Map process</div>
<div class="line">    ......</div>
<div class="line">    # Regression</div>
<div class="line">    ......</div>
<div class="line">    # write template py</div>
<div class="line">    ......</div>
<div class="line">    # generate the correct &quot;low theorem&quot; --&gt; &quot;hig theorem&quot; and write goals out into json config files &quot;./autogenerated/domain_steps_configJSON/{0}_{1}_config.json&quot;</div>
<div class="line">    # steps of how to map hig level description into low level golog FOL formula and prove:</div>
<div class="line">    # 1. I</div>
<div class="line">    # 2. G</div>
<div class="line">    # 3. pres of actions</div>
<div class="line">    # 4. effs of actions</div>
<div class="line">    ......</div>
<div class="line">    # generate the python_prove*_file we want </div>
<div class="line">    # with &quot;./midfile/{domainname}_*I/G_config.json&quot; and &quot;{domainnaoe}_template.py&quot;</div>
<div class="line">    ......</div>
<div class="line">    # generate the python_prove*_file we want </div>
<div class="line">    # with &quot;./midfile/{domainname}_*Pre/Eff_config.json&quot; and &quot;{domainnaoe}_template.py&quot;</div>
<div class="line">    ......</div>
<div class="line">    # run_all_python_prove_file_in_dir_autogenerated    </div>
</div><!-- fragment --><p> <code>parser</code>Read qnp file / pddl file of STRIPS:</p>
<div class="fragment"><div class="line">QNPparser.py # parser that reads qnp files</div>
<div class="line">PDDLaction.py # Low-level action class, used in refinementMapParser.py to store low-level STRIPS action information</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md5"></a>
Parsers</h2>
<h3><a class="anchor" id="autotoc_md6"></a>
QNPparser</h3>
<p>Member variables stored by <code>qnp_action</code>:</p>
<div class="fragment"><div class="line">class qnp_action:</div>
<div class="line">    def __init__(self,actionnameline,prelist,efflist,all_variables,all_fluents) -&gt; None:</div>
<div class="line">self.name = actionnameline # High-level action name      </div>
<div class="line">self.prestate = {}# High-level action pre premise      </div>
<div class="line">self.effstate = {}# High-level action eff effect</div>
</div><!-- fragment --><p> <code>QNP_Parser</code>Stores member variables： </p><div class="fragment"><div class="line">class QNP_Parser:  </div>
<div class="line">def __init__(self,qnpfile) -&gt; None:       </div>
<div class="line">self.name = &quot;&quot; # name       </div>
<div class="line">self.initstate = {} # Initial state       </div>
<div class="line">self.goalstate = {} # Goal state       </div>
<div class="line">self.stateRepresentation_variables = [] # State represents numeric variables       </div>
<div class="line">self.stateRepresentation_fluents = [] # State representation logic Boolean variable</div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md7"></a>
ReinfinementMapParser.py</h3>
<div class="fragment"><div class="line">refinementMapParser.py # The parser of the pddl file and the parser of the refinement mapping file, called here</div>
<div class="line">GologProgramTree.py # In the refined mapping, a high-level action ==&gt; a low-level Golog program tree</div>
</div><!-- fragment --><p>This file includes the parser of the pddl file of the STRIPS model and the refinementmap file. The low-level action object class of the pddl used is in ``:</p>
<div class="fragment"><div class="line">class Action:</div>
<div class="line"> </div>
<div class="line">    def __init__(self, name, parameters, positive_preconditions, negative_preconditions, add_effects, del_effects):</div>
<div class="line">        self.name = name             # </div>
<div class="line">        self.parameters = parameters # </div>
<div class="line">        self.positive_preconditions = positive_preconditions # </div>
<div class="line">        self.negative_preconditions = negative_preconditions # </div>
<div class="line">        self.add_effects = add_effects # </div>
<div class="line">        self.del_effects = del_effects # </div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md8"></a>
Regression Classes</h2>
<div class="fragment"><div class="line">Regression.py # All functions related to regression, including &quot;single-step regression/cyclic regression to program input scenario s_i/extended existence regression/extended arbitrary regression&quot;. </div>
<div class="line">Topological sorting is used to reverse the scene change arrow, and then topological sorting is used to get the cyclic regression scene change order ssa is &quot;left node.s_output&quot; replaced with &quot;right node.s_input&quot;.</div>
<div class="line">def __init__#Specific initialization parameter input (self, domainname input problem-related name, STRIPS model object read by parserinput, QNP object read by qnp_parser, reverse_eachgolog_set_of_s_io_order_list records the context transformation relationship between high-level motion and low-level Golog program, reverse_situation_tree scenario migration tree, </div>
<div class="line">eachgolog_set_of_s_act scenario-action set, each_situation_action_args scenario-action-action parameter dictionary) -&gt; None:</div>
<div class="line"> </div>
<div class="line"># regression function initialization constructor input parameter analysis:</div>
</div><!-- fragment --><p>The functions of these functions are:</p>
<div class="fragment"><div class="line">def get_poss(self,act):</div>
<div class="line">&quot;&quot;&quot;Get poss&quot;&quot;&quot;</div>
<div class="line">def generate_poss_file(self):  </div>
<div class="line">&quot;&quot;&quot;Write a file of the number of high-level jobs, including Poss axioms in any possible context of each action&quot;&quot;&quot;</div>
<div class="line">def one_step_poss_regression(self,test_phi_formula,lowaction,domainname,hig_action_name,s_i):# action is&#39;low level action name&#39;</div>
<div class="line">&quot;&quot;&quot;one_step_poss_regression&quot;&quot;&quot;</div>
<div class="line">def get_ssa(self): </div>
<div class="line">&quot;&quot;&quot;Get low-level specific state transition ssa dictionary&quot;&quot;&quot;</div>
<div class="line">def generate_ssa_file(self):</div>
<div class="line">def one_step_ssa_regression(self,test_psi_formula,predicate,domainname,hig_action_name,s_i):   </div>
<div class="line">&quot;&quot;&quot;one_step_ssa_regression given&#39;predicate&#39; and&#39;formula&#39;&quot;&quot;&quot;</div>
</div><!-- fragment --><p>The main regression functions include:</p>
<div class="fragment"><div class="line"># the main Regression function entrances:</div>
<div class="line">def one_step_regression_with_all_poss_ssa(self,test_formula,hig_action_name,s_i):</div>
<div class="line">    &quot;&quot;&quot;Input a formula,return the formula after one_step_regression_with_all_poss_ssa&quot;&quot;&quot;</div>
<div class="line">    # 1. \mathcal{D}_{poss}:for all action one_step_poss_regression</div>
<div class="line">    # 2. \mathcal{D}_{ssa}:for all predicates one_step_ssa_regression</div>
<div class="line">    # 3. \mathcal{D}_{una}:do not simplify here but wait for output get it simplied by z3-solver to cancel the nested duplicated terms.</div>
<div class="line">def loop_regression_with_all_poss_ssa(self,test_formula,hig_action_name):</div>
<div class="line">    &quot;&quot;&quot;Input a formula,return the formula after loop multiple_steps_regression_with_all_poss_ssa&quot;&quot;&quot;</div>
<div class="line">def dump_regression_exists(self,predicate_args_str_or_formula_returned,golog_node,hig_name) -&gt; str:</div>
<div class="line">        &quot;&quot;&quot;Existentially Extended regression&quot;&quot;&quot;    </div>
<div class="line">def dump_regression_universal(self,predicate_args_str_or_formula_returned,golog_node,hig_name) -&gt; str:</div>
<div class="line">    &quot;&quot;&quot;Universally Extended regression&quot;&quot;&quot;</div>
<div class="line"># Predicate formula predicate_formula, the ending scenario of the predicate after the action in the predicate formula is completed every_end_s</div>
<div class="line"># Distinguish golog_node.s_i, golog_node.s_o under specific actions</div>
<div class="line">def generate_exists_and_universal_regression_map_dict(self): </div>
<div class="line">&quot;&quot;&quot;reverse predicate and make dict for exists/universal&quot;&quot;&quot;</div>
<div class="line">def generate_exists_and_universal_regression_map_dict(self): </div>
<div class="line">&quot;&quot;&quot;Generate all predicate and make dict for exists/universal &quot;&quot;&quot;</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
